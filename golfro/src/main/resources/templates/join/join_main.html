<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>조인｜GOLFRO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    	  rel="stylesheet"
    	  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    	  crossorigin="anonymous">
    <link rel="stylesheet" href="/css/join_main.css" />
    <link rel="stylesheet" href="/css/header.css" />
    <link rel="stylesheet" href="/css/footer.css" />
</head>
<body>
    <div class="container-fluid">
        <header th:replace="~{fragments/header :: header}"></header>

        <div class="menu-header">
            <h2>
                <a th:href="@{/join/join_main}">JOIN</a>
            </h2>
            <h7>마음 맞는 사람과 함께 골프를 쳐보세요.</h7>
        </div>
        <div class="mobile-header">
            <a th:href="@{/review/review_main}">LESSON > </a>
            <span>골프에 대해 궁금한 점들을 물어보세요.</span>
        </div>
        <div class="d-flex justify-content-center">
            <div class="card border-0">
                <!-- 검색 폼과 기타 요소들은 그대로 유지 -->
                <div class="card-header border-0">
                    <!-- 카테고리 선택 폼 추가 -->
                    <form th:action="@{/join/join_main}" method="get">
                        <div class="row d-flex justify-content-between align-items-center">
                            <div class="row d-flex justify-content-between align-items-center">
                                <!-- 왼쪽: 글쓰기 버튼 -->
                                <div class="col-auto">
                                    <th:block th:if="${session.signedInUser ne null}">
                                        <a th:href="@{/join/join_create}" class="btn custom-btn" id="btnCreateMainPost"> <i class="bi bi-pencil-fill"></i>
                                            글쓰기
                                        </a>
                                    </th:block>
                                    <th:block th:if="${session.signedInUser eq null}">
                                        <a th:href="@{/user/signin}" class="btn custom-btn" id="btnCreatePost"> <i class="bi bi-pencil-fill"></i>
                                            글쓰기
                                        </a>
                                    </th:block>
                                </div>

                                <!-- 오른쪽: 검색 부분 -->
                                <div class="search-input row col-md-8 justify-content-end" id="category-search">
                                    <div class="search-field col-auto p-0">
                                        <select class="form-control custom-select" name="category" id="category">
                                            <option th:value="'t'" th:selected="${selectedCategory == 't'}">골프장명</option>
                                            <option th:value="'g'" th:selected="${selectedCategory == 'g'}">지역</option>
                                            <option th:value="'h'" th:selected="${selectedCategory == 'h'}">홀수</option>
                                        </select>
                                    </div>
                                    <div
                                        class="search-field col-auto px-1">
                                        <input type="text" class="form-control custom-input" id="keyword" name="keyword" placeholder="검색어를 입력하세요." th:value="${keyword}" />
                                    </div>
                                    <div class="col-auto search-button p-0">
                                        <button type="submit" class="btn no-radius" id="searchButton">
                                            <i class="bi bi-search"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-body">
                    <div class="card-body-date">
                        <div class="row d-flex justify-content-start align-items-center">
                            <!-- 왼쪽: 실시간 티타임 예약 텍스트 -->
                            <span class="col-auto">실시간 티타임 예약</span>

                            <!-- 오른쪽: 새로고침 버튼 -->
                            <button type="button" class="btn col-auto p-0" id="btnAllRead" onclick="location.href='join_main'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-arrow-repeat" viewBox="0 0 16 16">
                                    <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41m-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9" />
                                    <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5 5 0 0 0 8 3M3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9z" />
                                </svg>
                            </button>
                        </div>

						<div class="tab-header flex-grow-1">
							<div class="date-container">
								<div>
									<button class="btn btn-link text-black" id="prevBtn">◀</button>
								</div>
								<div>
									<a th:href="@{#}" id="date1" class="date-header"></a>
								</div>
								<div>
									<a th:href="@{#}" id="date2" class="date-header"></a>
								</div>
								<div>
									<a th:href="@{#}" id="date3" class="date-header"></a>
								</div>
								<div>
									<a th:href="@{#}" id="date4" class="date-header"></a>
								</div>
								<div>
									<a th:href="@{#}" id="date5" class="date-header"></a>
								</div>
								<div>
									<a th:href="@{#}" id="date6" class="date-header"></a>
								</div>
								<div>
									<button class="btn btn-link text-black" id="nextBtn">▶</button>
								</div>
							</div>
						</div>
						<!-- 카드 형식으로 변환된 포스트 목록 -->
						<div class="row row-cols-2 row-cols-sm-2 row-cols-md-3 g-4 mt-1">
                            <div id="todayDate" style="display: none;" th:value="${today}"></div>
                    
                            <div th:each="post : ${posts}" class="col d-flex justify-content-center">
                                <div class="card-list h-100" th:value="${post.teeoff}">
                                    <div class="card-info">
                                        <h6>
                                            <a th:href="@{/join/join_details(id=${post.id})}" class="custom-link" th:text="${post.title}">Title</a>
                                        </h6>
                                        <p>
                                            <small class="hole" th:text="${post.hole} + '홀'">Hole</small>
                                        </p>
                                        <p>
                                            <small class="teeoff-date" th:text="${#temporals.format(post.teeoff, 'yyyy-MM-dd HH:mm')}">Teeoff</small>
                                        </p>
                                        <p>
                                            <small th:text="${post.gcaddress}">Address</small>
                                        </p>
                                        <p class="mt-3">
                                            <strong th:text="${post.greenfee}">Greenfee</strong><small>원~</small>
                                        </p>
                                    </div>
                                    <div class="card-author text-center">
                                        <input type="hidden" class="imagePath" th:value="${post.user.image}" />
                                        <img class="rounded-circle image" src="" alt="Profile Picture"><br>
                                        <span th:text="${post.user.nickname}">Nickname</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer th:replace="~{fragments/footer :: footer}"></footer>
    
    <script>
    	let currentOffset = 0;
    
    	// 날짜 목록을 업데이트하는 함수
    	function getDates(currentOffset) {
    	    const today = new Date();
    	    const dates = [];
    
    	    for (let i = 0; i < 6; i++) { // 7일로 변경
    	        const date = new Date(today);
    	        date.setDate(today.getDate() + i + currentOffset);
    	        dates.push(date.toISOString().split('T')[0]); // YYYY-MM-DD 형식으로 변환
    	    }
    
    	    // 날짜 링크와 텍스트 설정
    	    const basePath = "/join/";
    	    document.getElementById('date1').textContent = dates[0] || '';
    	    document.getElementById('date2').textContent = dates[1] || '';
    	    document.getElementById('date3').textContent = dates[2] || '';
    	    document.getElementById('date4').textContent = dates[3] || '';
    	    document.getElementById('date5').textContent = dates[4] || '';
    	    document.getElementById('date6').textContent = dates[5] || '';
    	   
    	    document.getElementById('date1').href = dates[0] ? `${basePath}join_main?teeoffDate=${dates[0]}` : '#';
    	    document.getElementById('date2').href = dates[1] ? `${basePath}join_main?teeoffDate=${dates[1]}` : '#';
    	    document.getElementById('date3').href = dates[2] ? `${basePath}join_main?teeoffDate=${dates[2]}` : '#';
    	    document.getElementById('date4').href = dates[3] ? `${basePath}join_main?teeoffDate=${dates[3]}` : '#';
    	    document.getElementById('date5').href = dates[4] ? `${basePath}join_main?teeoffDate=${dates[4]}` : '#';
    	    document.getElementById('date6').href = dates[5] ? `${basePath}join_main?teeoffDate=${dates[5]}` : '#';
    	}
    
    	// 초기 날짜 목록을 설정합니다.
    	getDates(currentOffset);
    
    	document.getElementById('prevBtn').addEventListener('click', () => {
    	    currentOffset -= 6; // 6일씩 이동
    	    getDates(currentOffset);
    	});
    
    	document.getElementById('nextBtn').addEventListener('click', () => {
    	    currentOffset += 6; // 6일씩 이동
    	    getDates(currentOffset);
    	});
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 모든 .imagePath와 .image 클래스를 가진 요소를 찾습니다.
            var imagePaths = document.querySelectorAll('.imagePath');
            var images = document.querySelectorAll('.image');
    
            // .imagePath와 .image를 순회하면서 각각의 요소에 대해 작업합니다.
            imagePaths.forEach(function(input, index) {
                var file = input.value;
                var imageUrl = '/user/file/image?file=' + encodeURIComponent(file);  // 이미지 파일명에 맞게 설정
    
                if (file) {
                    fetch(imageUrl)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok.');
                            }
                            return response.blob();
                        })
                        .then(blob => {
                            var reader = new FileReader();
                            reader.onload = function() {
                                // .image 요소를 올바르게 업데이트합니다.
                                if (images[index]) {
                                    images[index].src = reader.result;
                                } else {
                                    console.error('No image element found for index:', index);
                                }
                            };
                            reader.readAsDataURL(blob);
                        })
                        .catch(error => {
                            console.error('Error fetching image:', error);
                        });
                } else {
                    console.error('No file path found for index:', index);
                }
            });
            
            const todayDateStr = document.getElementById("todayDate").value;
            const todayDate = new LocalDateTime(todayDateStr);
			console.log(todayDate);
            
            document.querySelectorAll('.card-list').forEach(card => {
                const teeoffDateStr = card.value;
                console.log(teeoffDateStr);
                if (teeoffDateStr < todayDate) {
                    card.classList.add('bg-light');
                }
            });
        });
    </script>

    <script th:src="@{/js/script.js}"></script>

    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>